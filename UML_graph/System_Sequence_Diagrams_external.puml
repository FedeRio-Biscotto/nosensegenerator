@startuml System_Sequence_Diagrams_external
!include Graphic.puml
actor User
participant "Generator" as Main
participant "Analyzer" as ApiGoogle
participant Dictionary
participant "Templates Library" as Template
participant "Toxicity Checker" as ApiToxicity

== Text Analysis Phase ==
User -> Main: analyzeSentence(text)
activate Main

Main -> ApiGoogle: analyze(text)
activate ApiGoogle
ApiGoogle --> Main: return List<Token>
deactivate ApiGoogle

Main -> Dictionary: saveNewTokens(tokens)
activate Dictionary
Dictionary --> Main: confirmSave
deactivate Dictionary

Main --> User: return "Analysis Complete"
deactivate Main

== Sentence Generation Phase ==
User -> Main: generateSentence()
activate Main

Main -> Template: getRandomTemplate()
activate Template
Template --> Main: return template
deactivate Template

Main -> Main: calculateRequiredTokens()

loop until valid sentence generated
    Main -> Dictionary: getTokens(requirements)
    activate Dictionary
    Dictionary --> Main: return tokens
    deactivate Dictionary

    Main -> Main: buildSentence(template, tokens)

    Main -> ApiToxicity: checkToxicity(sentence)
    activate ApiToxicity

    alt is toxic
        ApiToxicity --> Main: UNACCEPTABLE
        note right: Continue loop with\nnew tokens
    else is not toxic
        ApiToxicity --> Main: ACCEPTABLE
        deactivate ApiToxicity
        Main --> User: return generatedSentence
        deactivate Main
        break
    end
end

@enduml