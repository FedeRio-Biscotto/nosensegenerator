@startuml

!include Graphic.puml 

actor User
participant "Frontend (Browser)" as FE
participant "GeneratorController" as Controller
participant "Generator" as Generator
participant "TemplatesLibrary" as TemplatesLibrary
participant "MyDictionary" as Dictionary
participant "Template" as Template
participant "Moderator" as Moderator

== Generazione richiesta ==

User -> FE : Inserisce frase e seleziona parametri
FE -> Controller : POST /generate(inputSentence, tense, mode...)
Controller -> Generator : genSentence(sentence, tense)

== Caricamento template ==

Generator -> TemplatesLibrary : RandomTemplatePicker()
TemplatesLibrary --> Generator : Template

== Preparazione token e riempimento template ==

loop per ogni tipo token richiesto
    Generator -> Dictionary : getNoun() / getVerb() / getVerb_nothirdperson() / getAdj()
    Dictionary --> Generator : Token
end

Generator -> Template : FillTemplate(...) (o FillTemplate_past / future)
Template --> Generator : frase generata

== Controllo tossicità ==

Generator -> Moderator : checkToxicity(frase)
Moderator --> Generator : true / false

alt tossicità eccessiva
    Generator -> Generator : rigenera frase
end

Generator --> Controller : frase generata (o messaggio errore)
Controller --> FE : JSON con risultato
FE --> User : Visualizza frase

@enduml
