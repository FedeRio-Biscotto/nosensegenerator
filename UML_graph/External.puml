@startuml System_Sequence_Diagrams_external

actor User

participant Generator
participant Dictionary
participant "Templates Library" as TemplatesLibrary
participant Template
participant Analyzer
participant Moderator

== Text Analysis and Dictionary Update ==
User -> Generator: Enter sentence
activate Generator

Generator -> Analyzer: analyzeSentence(text)
activate Analyzer
Analyzer --> Generator: return List<Token>
deactivate Analyzer

Generator -> Dictionary: saveNewTokens(tokens)
activate Dictionary
Dictionary --> Generator: confirmSave
deactivate Dictionary

== Random Sentence Generation ==
Generator -> TemplatesLibrary: getRandomTemplate()
activate TemplatesLibrary
TemplatesLibrary --> Generator: return Template
deactivate TemplatesLibrary

loop for each required token type
    Generator -> Template: getRequiredTokens()
    activate Template
    Template -> Dictionary: getToken(type)
    activate Dictionary
    Dictionary --> Template: return Token
    deactivate Dictionary
    Template --> Generator: return TokenList
    deactivate Template
end

Generator -> Generator: shuffleTokenLists()

Generator -> TemplatesLibrary: fillTemplate(template, tokens)
activate TemplatesLibrary
TemplatesLibrary --> Generator: return Sentence
deactivate TemplatesLibrary

== Toxicity Validation ==
Generator -> Moderator: checkToxicity(sentence)
activate Moderator

alt is toxic
    Moderator --> Generator: return UNACCEPTABLE
    Generator --> User: Display "Content not appropriate"
else is not toxic
    Moderator --> Generator: return ACCEPTABLE
    deactivate Moderator
    Generator --> User: Display generated sentence
end
deactivate Generator

@enduml